<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Remessa #{{ r.numero }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root{ --ink:#0f172a; --muted:#64748b; --ring:rgba(37,99,235,.18); --g1:#000000; --g2:#000000; --base-font:14px; }
    html{ font-size: var(--base-font); }
    body{ background:#f6f8fb; color:var(--ink); }

    /* paper layout (mesmo estilo do orçamento) */
    .paper{ max-width: 960px; margin: 24px auto; background:#fff; border:1px solid #a7abb3; border-radius:12px; box-shadow:0 10px 24px rgba(17,24,39,.08); }
    .paper .p-wrap{ padding: 28px; }
    .brand-bar{ background:linear-gradient(90deg,var(--g1),var(--g2)); color:#fff; padding:14px 20px; border-top-left-radius:12px; border-top-right-radius:12px; }
    .brand-bar .logo{ height:44px; object-fit:contain; }
    .small-muted{ color: var(--muted); }

    .table{ font-size:.875rem; }
    .table thead th{ font-size:.78rem; text-transform:uppercase; letter-spacing:.04em; color:#64748b; border-top:0; }

    /* células em branco para preenchimento manual */
    .w-write{ min-width:80px; }
    .w-write-lg{ min-width:160px; }

    .sig-line{ border-top:1px solid #000; padding-top:.5rem; }

    /* caixa de instruções */
    .info-box{ border:1px dashed #cbd5e1; background:#fafbff; border-radius:10px; padding:12px; }

    /* manter cabeçalho/rodapé da tabela na impressão */
    thead { display: table-header-group; }
    tfoot { display: table-footer-group; }

    @page{ size:A4; margin:12mm; }
    @media print{
      body{ background:#fff; }
      .paper{ box-shadow:none; border:0; margin:0; }
      .no-print{ display:none !important; }
      .brand-bar{ -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .table thead th{ color:#000; }
      img{ page-break-inside: avoid; }
      table{ page-break-inside: auto; }
      tr, td, th { page-break-inside: avoid; page-break-after: auto; }
    }
  </style>
</head>
<body>

<div class="paper">
  <!-- topo (brand bar) -->
  <div class="brand-bar d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-3">
      {% if r.empresa.logo_has_file %}
        <img class="logo" src="{{ r.empresa.logo_url_safe }}" alt="{{ r.empresa.nome_fantasia }}">
      {% else %}
        <div class="fw-bold">{{ r.empresa.nome_fantasia }}</div>
      {% endif %}
      <div class="small">
        <div class="fw-semibold">Remessa</div>
        <div class="text-white-50">#{{ r.numero }} • {{ r.enviado_em|date:"d/m/Y H:i" }}</div>
      </div>
    </div>
    <button class="btn btn-light btn-sm no-print" onclick="window.print()">Imprimir</button>
  </div>

  <div class="p-wrap">
    <!-- EMPRESA / REMESSA -->
    <div class="row row-cols-1 row-cols-md-2 g-3 mb-3">
      <div class="col">
        <h2 class="h6 mb-1">Empresa</h2>
        <div class="small">
          <div class="fw-semibold">{{ r.empresa.nome_fantasia }}</div>
          {% if r.empresa.cnpj %}<div>CNPJ: {{ r.empresa.cnpj }}</div>{% endif %}
          {% if r.empresa.endereco %}<div>{{ r.empresa.endereco }}</div>{% endif %}
          {% if r.empresa.cidade or r.empresa.uf %}<div>{{ r.empresa.cidade }}{% if r.empresa.uf %}/{{ r.empresa.uf }}{% endif %}</div>{% endif %}
          {% if r.empresa.email %}<div>{{ r.empresa.email }}</div>{% endif %}
          {% if r.empresa.telefone %}<div>{{ r.empresa.telefone }}</div>{% endif %}
        </div>
      </div>
      <div class="col">
        <h2 class="h6 mb-1">Resumo da remessa</h2>
        <div class="small">
          <div><span class="small-muted">Tipo:</span> <strong>{{ r.get_tipo_display }}</strong></div>
          <div><span class="small-muted">Status:</span> {{ r.get_status_display }}</div>
          <div><span class="small-muted">Costureira:</span> {{ r.costureira.nome }}</div>
          {% if r.produto %}<div><span class="small-muted">Produto:</span> {{ r.produto.nome }}</div>{% endif %}
          <div><span class="small-muted">Kg enviados:</span> {{ r.kg_enviados|floatformat:3 }}</div>
          {% if r.observacao %}<div class="mt-1"><span class="small-muted">Obs.:</span> {{ r.observacao }}</div>{% endif %}
        </div>
      </div>
    </div>

    <!-- INSTRUÇÕES -->
    <div class="info-box small mb-3">
      <div class="fw-semibold mb-1">Instruções de preenchimento (recebimento)</div>
      <ul class="mb-0">
        <li>Confira a coluna <strong>Previsto</strong> para cada variação (tamanho/cor).</li>
        <li>Informe a quantidade <strong>OK</strong> (efetivamente recebida).</li>
        <li>Se houve, registre as quantidades de <strong>Perda</strong>, <strong>Extravio</strong> e <strong>Devolvida</strong>.</li>
        <li>A soma <em>OK + Perda + Extravio + Devolvida</em> deve conferir com o <em>Previsto</em> (ou justificar em Observações).</li>
      </ul>
    </div>

    <!-- ITENS -->
    <div class="table-responsive mb-2">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th style="width:36px;">#</th>
            <th>Produto / Variação</th>
            <th>Previsto</th>
            <th>OK</th>
            <th>Perda</th>
            <th>Extravio</th>
            <th>Devolvida</th>
            <th>Obs.</th>
          </tr>
        </thead>
        <tbody>
          {% for it in r.itens.all %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ it.variacao.produto.nome }} {{ it.variacao.tamanho }}/{{ it.variacao.cor }}</td>
            <td>{{ it.qtd_prevista }}</td>
            <td class="w-write"></td>
            <td class="w-write"></td>
            <td class="w-write"></td>
            <td class="w-write"></td>
            <td class="w-write-lg"></td>
          </tr>
          {% empty %}
          <tr><td colspan="8" class="text-center small-muted py-4">Sem itens.</td></tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr class="fw-bold">
            <td colspan="2">Total previsto</td>
            <td>{{ r.total_pecas_previstas }}</td>
            <td colspan="5"></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Observações e assinatura -->
    <div class="row mt-4 g-3">
      <div class="col-12 col-md-6">
        <div class="border rounded-3 p-3" style="min-height:110px">
          <div class="small-muted text-uppercase mb-2">Observações (recebimento)</div>
        </div>
      </div>
      <div class="col-12 col-md-6 d-flex align-items-end">
        <div class="w-100 text-center mt-4">
          <div class="sig-line">Assinatura da costureira</div>
        </div>
      </div>
    </div>

    <!-- Rodapé -->
    <div class="mt-3 small d-flex justify-content-between">
      <div class="small-muted">Emitido em {% now "d/m/Y H:i" %}</div>
      <div>Pág. <span class="pageNumber">1</span></div>
    </div>

    <div class="d-flex justify-content-end gap-2 mt-4 no-print">
      <a class="btn btn-outline-secondary" href="{% url 'camisas:remessa_detail' r.id %}">Voltar</a>
      <button class="btn btn-primary" onclick="window.print()">Imprimir / Salvar em PDF</button>
    </div>
  </div>
</div>

</body>
</html>
