{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>Despesas • Camisas</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    :root{--ink:#0f172a;--muted:#64748b;--ring:rgba(37,99,235,.18);--base-font:14px;}
    html{font-size:var(--base-font);} body{background:#f6f8fb;color:var(--ink);}
    .card{border:none;box-shadow:0 10px 24px rgba(17,24,39,.08);border-radius:.9rem;}
    .mini{font-size:.85rem;color:var(--muted)}
  </style>
</head>
<body>
<nav class="navbar navbar-dark" style="background:linear-gradient(90deg,#f30c80,#f30c80)">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="{% url 'camisas:home' %}">EMPÓRIO DA KATY</a>
    <div class="d-flex gap-2">
      <a class="btn btn-sm btn-light" href="{% url 'camisas:despesa_create' %}">+ Nova despesa</a>
      <a class="btn btn-sm btn-outline-light" href="{% url 'camisas:home' %}">Dashboard</a>
    </div>
  </div>
</nav>

<main class="container py-4">
  {% for m in messages %}<div class="alert alert-{{ m.tags }}">{{ m }}</div>{% endfor %}

  <div class="card p-3 mb-3">
    <form class="row g-2" method="get">
      <div class="col-12 col-md-3">
        <label class="form-label mini">Empresa</label>
        <select name="empresa" class="form-select">
          <option value="">Todas</option>
          {% for e in empresas %}
            <option value="{{ e.id }}" {% if request.GET.empresa|default:'' == e.id|stringformat:"s" %}selected{% endif %}>{{ e.nome_fantasia }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label mini">De</label>
        <input type="date" name="de" value="{{ request.GET.de|default:'' }}" class="form-control">
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label mini">Até</label>
        <input type="date" name="ate" value="{{ request.GET.ate|default:'' }}" class="form-control">
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label mini">Status</label>
        <select name="status" class="form-select">
          <option value="">Todos</option>
          <option value="PEN" {% if request.GET.status == 'PEN' %}selected{% endif %}>Pendente</option>
          <option value="PAGA" {% if request.GET.status == 'PAGA' %}selected{% endif %}>Paga</option>
          <option value="CANC" {% if request.GET.status == 'CANC' %}selected{% endif %}>Cancelada</option>
        </select>
      </div>
      <div class="col-6 col-md-3 d-flex gap-2">
        <button class="btn btn-primary flex-grow-1">Aplicar</button>
        <a class="btn btn-outline-secondary" href="{% url 'camisas:despesa_list' %}">Limpar</a>
      </div>
    </form>
  </div>

  <div class="card p-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h2 class="h6 m-0">Despesas</h2>
      <div class="mini">Total no filtro: <strong>R$ {{ total|floatformat:2 }}</strong></div>
    </div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead><tr>
          <th>#</th><th>Descrição</th><th>Categoria</th><th>Fornecedor</th>
          <th>Valor</th><th>Emissão</th><th>Venc.</th><th>Status</th><th></th>
        </tr></thead>
        <tbody>
          {% for d in despesas %}
            <tr>
              <td class="fw-semibold">#{{ d.id }}</td>
              <td>{{ d.descricao }}</td>
              <td>{{ d.categoria }}</td>
              <td>{{ d.fornecedor|default:"—" }}</td>
              <td>R$ {{ d.valor_total|floatformat:2 }}</td>
              <td>{{ d.data_emissao|date:"d/m/Y" }}</td>
              <td>{{ d.vencimento|date:"d/m/Y"|default:"—" }}</td>
              <td>
                <span class="badge {% if d.status == 'PAGA' %}text-bg-success{% elif d.status == 'PEN' %}text-bg-warning{% else %}text-bg-secondary{% endif %}">
                  {{ d.get_status_display }}
                </span>
              </td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'camisas:despesa_update' d.id %}">Abrir</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="9" class="text-center text-muted py-4">Sem despesas.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</main>
</body>
</html>
