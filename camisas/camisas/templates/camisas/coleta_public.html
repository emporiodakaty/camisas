<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>Informar tamanhos — Pedido #{{ pedido.pk }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    :root{ --ink:#0f172a; --muted:#64748b; --g1:#f30c80; --g2:#f30c80; --base:14px; }
    html{font-size:var(--base)} body{background:#f6f8fb;color:var(--ink)}
    .paper{max-width:820px;margin:18px auto;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 10px 24px rgba(17,24,39,.08)}
    .brand{background:linear-gradient(90deg,var(--g1),var(--g2));color:#fff;border-radius:12px 12px 0 0;padding:10px 14px}
    .p-wrap{padding:16px}
    .card-clean{border:none;border-radius:.9rem;box-shadow:0 10px 24px rgba(17,24,39,.08);background:#fff}
    .mini{font-size:.85rem;color:var(--muted)}
    .table thead th{font-size:.78rem;text-transform:uppercase;letter-spacing:.04em;color:#64748b;border-top:0}
  </style>
</head>
<body>
<div class="paper">
  <div class="brand d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-3">
      {% if empresa and empresa.logo_has_file and empresa.logo_url_safe %}
        <img src="{{ empresa.logo_url_safe }}" alt="Logo" style="height:34px;object-fit:contain">
      {% endif %}
      <div>
        <div class="fw-bold">Informar tamanhos</div>
        <div class="text-white-50 small">Pedido #{{ pedido.pk }} • {{ pedido.criado_em|date:"d/m/Y" }}</div>
      </div>
    </div>
  </div>

  <div class="p-wrap">
    {% for m in messages %}<div class="alert alert-{{ m.tags }}">{{ m }}</div>{% endfor %}

    <form method="post" id="formColeta">
      {% csrf_token %}

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Seu nome</label>
          <input name="nome" type="text" class="form-control" value="{{ cliente.nome|default:'' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">E-mail</label>
          <input name="email" type="email" class="form-control" value="{{ cliente.email|default:'' }}">
        </div>
        <div class="col-12">
          <label class="form-label">Observações</label>
          <textarea name="obs" class="form-control" rows="2" placeholder="Ex.: nome na manga, patch, fonte, etc."></textarea>
        </div>
      </div>

      <hr class="my-3">

      {% if coleta.modo == 'SIMPLES' %}
        <h2 class="h6">Quantidades por tamanho</h2>
        <div class="table-responsive">
          <table class="table align-middle">
            <thead><tr>{% for t in tamanhos %}<th>{{ t }}</th>{% endfor %}<th>Total</th></tr></thead>
            <tbody>
              <tr>
                {% for t in tamanhos %}
                  <td style="max-width:120px"><input type="number" min="0" name="q_{{ t }}" class="form-control" value="0" oninput="sumTot()"></td>
                {% endfor %}
                <td style="width:120px"><input id="totalField" type="number" class="form-control" readonly></td>
              </tr>
            </tbody>
          </table>
        </div>

      {% elif coleta.modo == 'NOMES' %}
        <h2 class="h6">Tamanhos + nomes</h2>
        <p class="mini">Preencha uma linha por pessoa (número é opcional).</p>
        <div class="table-responsive">
          <table id="tbl" class="table align-middle">
            <thead><tr><th style="width:45%">Nome</th><th style="width:20%">Número</th><th style="width:25%">Tamanho</th><th style="width:10%"></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <button class="btn btn-outline-primary btn-sm" type="button" onclick="addRow()">+ Adicionar</button>

      {% else %}
        <h2 class="h6">Time (nome + número + tamanho)</h2>
        <div class="table-responsive">
          <table id="tbl" class="table align-middle">
            <thead><tr><th style="width:45%">Nome</th><th style="width:20%">Número</th><th style="width:25%">Tamanho</th><th style="width:10%"></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <button class="btn btn-outline-primary btn-sm" type="button" onclick="addRow()">+ Adicionar jogador</button>
      {% endif %}

      <div class="d-flex justify-content-end gap-2 mt-3">
        <button class="btn btn-primary">Enviar</button>
      </div>
    </form>
  </div>
</div>

<script>
function sumTot(){
  const inputs = document.querySelectorAll('input[name^="q_"]');
  let tot = 0; inputs.forEach(i=> tot += parseInt(i.value||'0',10));
  const t = document.getElementById('totalField'); if(t) t.value = tot;
}

function addRow(){
  const tbody = document.querySelector('#tbl tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input name="names[]" class="form-control" placeholder="Nome"></td>
    <td style="max-width:120px"><input name="numbers[]" class="form-control" placeholder="00"></td>
    <td>
      <select name="sizes[]" class="form-select">
        {% for t in tamanhos %}<option value="{{ t }}">{{ t }}</option>{% endfor %}
      </select>
    </td>
    <td class="text-end"><button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest('tr').remove()">Remover</button></td>
  `;
  tbody.appendChild(tr);
}
</script>
</body>
</html>
